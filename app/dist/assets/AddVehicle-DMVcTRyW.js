import{r as o,j as e,k as L,U as V,C as D,aB as W,X as Y,aw as U,ap as T,ao as q}from"./react-vendor-JE9gdlBQ.js";import{a as $,u as O,i as H,d as X}from"./vehicles-CkZMpXtf.js";import{u as G}from"./index-DaAC2zqA.js";import{g as J,v as K}from"./vehicleData-BAhqvYk7.js";import{b as Q}from"./router-DL0rZlEF.js";import"./vendor-C1Py2TwH.js";import"./utils-2shQNo7D.js";function Z({vehicleId:t,vehicleMake:m,vehicleModel:y,onImageUploaded:v,onBack:C}){const[n,N]=o.useState(new Map),[h,x]=o.useState(!1),[u,d]=o.useState(null),[k,S]=o.useState(!1),[j,g]=o.useState([]),[_,I]=o.useState(!0),f=o.useRef(new Map);o.useEffect(()=>{(async()=>{var l;try{const a=await $();a.success&&((l=a.data)!=null&&l.allowed_image_types)&&g(a.data.allowed_image_types)}catch(a){console.error("Failed to load allowed image types:",a)}finally{I(!1)}})()},[]);const B=s=>s.type.startsWith("image/"),c=s=>s.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "),z=s=>l=>{var p;const a=(p=l.target.files)==null?void 0:p[0];if(a){if(!B(a)){d("Please select a valid image file");return}if(a.size>5*1024*1024){d("Image file size must be less than 5MB");return}d(null);const w=new FileReader;w.onload=F=>{var R;const M=(R=F.target)==null?void 0:R.result;N(P=>{const E=new Map(P);return E.set(s,{file:a,preview:M,type:s}),E})},w.readAsDataURL(a)}},b=s=>{N(a=>{const p=new Map(a);return p.delete(s),p});const l=f.current.get(s);l&&(l.value="")},A=s=>{const l=f.current.get(s);l&&l.click()},i=async()=>{var s,l;if(n.size===0){d("Please select at least one image to upload");return}x(!0),d(null);try{const a=[],p=[];n.forEach((F,M)=>{a.push(F.file),p.push(M)});const w=await O(t,a,p);if(w.success)S(!0),setTimeout(()=>{v()},2e3);else throw new Error(w.message||"Failed to upload images")}catch(a){console.error("Failed to upload image:",a),d(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.detail)||a.message||"Failed to upload image. Please try again.")}finally{x(!1)}},r=()=>{v()};return k?e.jsxs("div",{className:"bw-card",style:{textAlign:"center",padding:"48px 24px"},children:[e.jsx("div",{style:{color:"var(--bw-success, #1E7F4A)",marginBottom:"16px"},children:e.jsx(L,{className:"w-12 h-12 mx-auto"})}),e.jsx("h3",{style:{margin:"0 0 16px 0",color:"var(--bw-success, #1E7F4A)"},children:"Image Uploaded Successfully!"}),e.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280"},children:"Your vehicle image has been uploaded. Redirecting to dashboard..."})]}):e.jsxs("div",{className:"bw-card",style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsx("div",{className:"bw-card-header",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:40,height:40,border:"1px solid var(--bw-border-strong)",display:"grid",placeItems:"center",borderRadius:2},children:e.jsx(V,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:20},children:"Add Vehicle Image"}),e.jsxs("p",{className:"small-muted",style:{margin:"4px 0 0 0"},children:["Upload an image for your ",m," ",y]})]})]})}),e.jsxs("div",{style:{padding:"24px"},children:[u&&e.jsxs("div",{style:{marginBottom:24,padding:"12px",backgroundColor:"#fee2e2",border:"1px solid #fecaca",borderRadius:"4px",color:"#dc2626",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(D,{size:16}),u]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:600},children:"Vehicle Images"}),_?e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#6b7280"},children:"Loading image types..."}):j.length===0?e.jsx("div",{style:{textAlign:"center",padding:"24px",color:"#6b7280"},children:"No image types available for this vehicle category."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:j.map(s=>{const l=n.get(s);return e.jsxs("div",{style:{border:"1px solid var(--bw-border)",borderRadius:"8px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(W,{size:20,style:{color:"var(--bw-text)",opacity:.7}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:500,color:"var(--bw-text)"},children:c(s)})]}),l&&e.jsxs("span",{style:{fontSize:"12px",color:"var(--bw-success, #1E7F4A)",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(L,{size:14}),"Selected"]})]}),l?e.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[e.jsx("img",{src:l.preview,alt:`${s} preview`,style:{width:"100%",maxHeight:"200px",objectFit:"contain",borderRadius:"8px",border:"1px solid var(--bw-border)"}}),e.jsx("button",{type:"button",onClick:()=>b(s),style:{position:"absolute",top:"8px",right:"8px",background:"var(--bw-error, #C5483D)",color:"white",border:"none",borderRadius:"50%",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:e.jsx(Y,{size:14})})]}):e.jsxs("button",{type:"button",onClick:()=>A(s),style:{width:"100%",padding:"16px",border:"2px dashed var(--bw-border-strong)",borderRadius:"8px",backgroundColor:"transparent",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",transition:"border-color 0.2s"},onMouseEnter:a=>{a.currentTarget.style.borderColor="var(--bw-fg)"},onMouseLeave:a=>{a.currentTarget.style.borderColor="var(--bw-border-strong)"},children:[e.jsx(V,{size:24,style:{color:"#6b7280"}}),e.jsxs("span",{style:{fontSize:"14px",color:"var(--bw-text)"},children:["Click to upload ",c(s)," image"]}),e.jsx("span",{style:{fontSize:"12px",color:"#6b7280"},children:"Max 5MB"})]}),e.jsx("input",{ref:a=>{a&&f.current.set(s,a)},type:"file",accept:"image/*",onChange:z(s),style:{display:"none"}})]},s)})})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"space-between",borderTop:"1px solid var(--bw-border)",paddingTop:"24px"},children:[e.jsx("button",{type:"button",className:"bw-btn-outline",onClick:C,disabled:h,children:"Back to Vehicle Info"}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("button",{type:"button",className:"bw-btn-outline",onClick:r,disabled:h,children:"Skip for Now"}),e.jsx("button",{type:"button",className:"bw-btn bw-btn-action",onClick:i,disabled:n.size===0||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bw-loading-spinner",style:{width:"16px",height:"16px"}}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Upload ",n.size>0?`${n.size} `:"","Image",n.size!==1?"s":""]})})]})]})]})]})}function oe(){const[t,m]=o.useState({make:"",model:"",year:"",license_plate:"",color:"",status:"available",vehicle_category:"",vehicle_flat_rate:"",seating_capacity:4}),[y,v]=o.useState(!1),[C,n]=o.useState(null),[N,h]=o.useState(!1),[x,u]=o.useState([]),[d,k]=o.useState(!0),[S,j]=o.useState("vehicle-info"),[g,_]=o.useState(null),I=t.make?J(t.make):[],f=Q(),{role:B}=G();o.useEffect(()=>{(async()=>{try{k(!0);const r=await H();r.success&&r.data?(u(r.data),r.data.length>0&&m(s=>({...s,vehicle_category:r.data[0].vehicle_category,vehicle_flat_rate:r.data[0].vehicle_flat_rate.toString()}))):u([])}catch(r){console.error("Failed to load vehicle categories:",r),u([])}finally{k(!1)}})()},[]);const c=i=>{const{name:r,value:s}=i.target;if(r==="vehicle_category"){const l=x.find(a=>a.vehicle_category===s);if(l){m(a=>({...a,[r]:s,vehicle_flat_rate:l.vehicle_flat_rate.toString()}));return}}if(r==="make"){m(l=>({...l,[r]:s,model:""}));return}m(l=>({...l,[r]:s}))},z=async i=>{var r,s;if(i.preventDefault(),!t.make||!t.model){n("Make and Model are required fields");return}v(!0),n(null);try{const l={make:t.make,model:t.model,year:t.year?parseInt(t.year):void 0,license_plate:t.license_plate||void 0,color:t.color||void 0,status:t.status,vehicle_category:t.vehicle_category,vehicle_flat_rate:parseFloat(t.vehicle_flat_rate)||0,seating_capacity:parseInt(t.seating_capacity.toString())||4},a=await X(l);if(a.success&&a.data)_(a.data),h(!0);else throw new Error(a.message||"Failed to create vehicle");setTimeout(()=>{j("image-upload"),h(!1)},1500)}catch(l){console.error("Failed to create vehicle:",l),n(((s=(r=l.response)==null?void 0:r.data)==null?void 0:s.detail)||"Failed to create vehicle. Please try again.")}finally{v(!1)}},b=()=>{S==="image-upload"?(j("vehicle-info"),_(null)):f("/tenant/overview")},A=()=>{f("/tenant/overview")};return S==="image-upload"&&g?e.jsxs("div",{className:"bw bw-container",style:{padding:"24px 0"},children:[e.jsx("div",{className:"bw-header",style:{marginBottom:32},children:e.jsxs("div",{className:"bw-header-content",children:[e.jsxs("button",{className:"bw-btn-outline",onClick:b,style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(U,{className:"w-4 h-4"}),"Back to Vehicle Info"]}),e.jsx("h1",{style:{fontSize:32,margin:"0 0 0 24px"},children:"Add Vehicle Image"})]})}),e.jsx(Z,{vehicleId:g.id,vehicleMake:g.make,vehicleModel:g.model,onImageUploaded:A,onBack:b})]}):N?e.jsx("div",{className:"bw bw-container",style:{padding:"24px 0"},children:e.jsxs("div",{className:"bw-card",style:{textAlign:"center",padding:"48px 24px"},children:[e.jsx("div",{style:{color:"var(--bw-success, #1E7F4A)",marginBottom:"16px"},children:e.jsx(T,{className:"w-12 h-12 mx-auto"})}),e.jsx("h3",{style:{margin:"0 0 16px 0",color:"var(--bw-success, #1E7F4A)"},children:"Vehicle Created Successfully!"}),e.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280"},children:"Your new vehicle has been added to your fleet. Now let's add an image..."})]})}):e.jsxs("div",{className:"bw bw-container",style:{padding:"24px 0"},children:[e.jsx("div",{className:"bw-header",style:{marginBottom:32},children:e.jsxs("div",{className:"bw-header-content",children:[e.jsxs("button",{className:"bw-btn-outline",onClick:b,style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(U,{className:"w-4 h-4"}),"Back to Dashboard"]}),e.jsx("h1",{style:{fontSize:32,margin:"0 0 0 24px"},children:"Add New Vehicle"})]})}),e.jsxs("div",{className:"bw-card",style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsx("div",{className:"bw-card-header",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:40,height:40,border:"1px solid var(--bw-border-strong)",display:"grid",placeItems:"center",borderRadius:2},children:e.jsx(T,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:20},children:"Vehicle Information"}),e.jsx("p",{className:"small-muted",style:{margin:"4px 0 0 0"},children:"Add a new vehicle to your fleet"})]})]})}),e.jsxs("form",{onSubmit:z,style:{padding:"24px"},children:[C&&e.jsx("div",{style:{marginBottom:24,padding:"12px",backgroundColor:"#fee2e2",border:"1px solid #fecaca",borderRadius:"4px",color:"#dc2626",fontSize:"14px"},children:C}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:600},children:"Basic Information"}),e.jsxs("div",{className:"bw-form-grid",style:{display:"grid",gap:"16px",gridTemplateColumns:"1fr 1fr"},children:[e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Make *"}),e.jsxs("select",{className:"bw-input",name:"make",value:t.make,onChange:c,required:!0,style:{color:"#000000",backgroundColor:"#ffffff"},children:[e.jsx("option",{value:"",style:{color:"#000000",backgroundColor:"#ffffff"},children:"Select Make"}),K.map(i=>e.jsx("option",{value:i,style:{color:"#000000",backgroundColor:"#ffffff"},children:i},i))]})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Model *"}),e.jsxs("select",{className:"bw-input",name:"model",value:t.model,onChange:c,required:!0,style:{color:"#000000",backgroundColor:"#ffffff"},disabled:!t.make,children:[e.jsx("option",{value:"",style:{color:"#000000",backgroundColor:"#ffffff"},children:t.make?"Select Model":"Select Make First"}),I.map(i=>e.jsx("option",{value:i,style:{color:"#000000",backgroundColor:"#ffffff"},children:i},i))]})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Year"}),e.jsx("input",{className:"bw-input",type:"number",name:"year",min:"1900",max:new Date().getFullYear()+1,value:t.year,onChange:c,placeholder:"2024",maxLength:4})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Color"}),e.jsx("input",{className:"bw-input",name:"color",value:t.color,onChange:c,placeholder:"White"})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"License Plate"}),e.jsx("input",{className:"bw-input",name:"license_plate",value:t.license_plate,onChange:c,placeholder:"ABC-123",maxLength:8})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Status"}),e.jsxs("select",{className:"bw-input",name:"status",value:t.status,onChange:c,children:[e.jsx("option",{value:"available",style:{color:"#000000",backgroundColor:"#ffffff"},children:"Available"}),e.jsx("option",{value:"maintenance",style:{color:"#000000",backgroundColor:"#ffffff"},children:"Maintenance"}),e.jsx("option",{value:"out_of_service",style:{color:"#000000",backgroundColor:"#ffffff"},children:"Out of Service"})]})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Seating Capacity"}),e.jsx("input",{className:"bw-input",type:"number",name:"seating_capacity",min:"1",max:"20",value:t.seating_capacity,onChange:c})]})]})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:600},children:"Vehicle Category"}),e.jsxs("div",{className:"bw-form-grid",style:{display:"grid",gap:"16px",gridTemplateColumns:"1fr 1fr"},children:[e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Vehicle Category"}),e.jsx("select",{className:"bw-input",name:"vehicle_category",value:t.vehicle_category,onChange:c,style:{color:"#000000",backgroundColor:"#ffffff"},children:d?e.jsx("option",{value:"",style:{color:"#000000",backgroundColor:"#ffffff"},children:"Loading categories..."}):x.length===0?e.jsx("option",{value:"",style:{color:"#000000",backgroundColor:"#ffffff"},children:"No categories available"}):x.map(i=>e.jsx("option",{value:i.vehicle_category,style:{color:"#000000",backgroundColor:"#ffffff"},children:i.vehicle_category},i.id))})]}),e.jsxs("div",{className:"bw-form-group",children:[e.jsx("label",{className:"bw-form-label",children:"Base Rate ($)"}),e.jsx("input",{className:"bw-input",type:"number",name:"vehicle_flat_rate",min:"0",step:"0.01",value:t.vehicle_flat_rate,readOnly:!0,style:{backgroundColor:"#f3f4f6",color:"#6b7280"},placeholder:"Auto-populated"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",justifyContent:"flex-end",borderTop:"1px solid var(--bw-border)",paddingTop:"24px"},children:[e.jsx("button",{type:"button",className:"bw-btn-outline",onClick:b,disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bw-btn bw-btn-action",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bw-loading-spinner",style:{width:"16px",height:"16px"}}),"Creating Vehicle..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),"Next: Add Vehicle"]})})]})]})]})]})}export{oe as default};
